<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vue3 Gantt ç‹¬ç«‹ç»„ä»¶ç¤ºä¾‹</title>

  <!-- å¼•å…¥ Vue 3 -->
  <!-- å¼•å…¥ Vue 3 -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <!-- å¼•å…¥ä¾èµ–åº“ -->
  <script src="https://unpkg.com/dayjs@1.11.13/dayjs.min.js"></script>
  <script src="https://unpkg.com/@vueuse/core@11.3.0/index.iife.min.js"></script>
  <script src="https://unpkg.com/interactjs@1.10.27/dist/interact.min.js"></script>
  <script src="https://unpkg.com/svg.js@2.7.1/dist/svg.min.js"></script>
  <!-- zod ä¸éœ€è¦åœ¨æµè§ˆå™¨ç¯å¢ƒä¸­åŠ è½½ï¼Œç»„ä»¶å†…éƒ¨å·²ç»å¤„ç† -->

  <!-- å¼•å…¥ Gantt ç»„ä»¶æ ·å¼ -->
  <link rel="stylesheet" href="./dist/vue3-gantt.css">

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    /* 
     * é‡è¦ï¼šä½¿ç”¨ height: 100% æ—¶ï¼Œå¿…é¡»ç¡®ä¿ html å’Œ body ä¹Ÿè®¾ç½®äº† height: 100%
     * å¦åˆ™ç»„ä»¶ä¼šé«˜åº¦å¡”é™·
     */
    html, body {
      height: 100%;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    /* 
     * æ–¹å¼ 1ï¼ˆå½“å‰ä½¿ç”¨ï¼‰ï¼šhtml/body è®¾ç½® 100% + #app è®¾ç½® 100vh
     * ä¼˜ç‚¹ï¼šç®€å•ç›´æ¥ï¼Œä¸ä¾èµ–çˆ¶å…ƒç´ 
     */
    #app {
      width: 100vw;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* 
     * æ–¹å¼ 2ï¼ˆä¹Ÿå¯ä½¿ç”¨ï¼‰ï¼šhtml/body/app å…¨éƒ¨è®¾ç½® 100%
     * #app {
     *   width: 100%;
     *   height: 100%; 
     *   display: flex;
     *   flex-direction: column;
     * }
     */

    .demo-header {
      background: linear-gradient(145deg, #f5f5f5, #e8e8e8);
      border-bottom: 1px solid #d0d0d0;
      padding: 16px 24px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .demo-header h1 {
      margin: 0;
      font-size: 20px;
      color: #333;
    }

    .demo-header p {
      margin: 4px 0 0;
      font-size: 13px;
      color: #666;
    }

    .gantt-wrapper {
      flex: 1;
      overflow: hidden;
    }
  </style>
</head>

<body>
  <div id="app">
    <div class="demo-header">
      <h1>ğŸ¯ Vue3 Gantt ç‹¬ç«‹ç»„ä»¶ç¤ºä¾‹</h1>
      <p>âœ… æ‰€æœ‰æ ·å¼å·²æ‰“åŒ…ï¼Œæ— éœ€å¤–éƒ¨ä¾èµ– | âœ… æ”¯æŒ 7 ç§ä¸»é¢˜ | âœ… æ”¯æŒ 8 ç§è¯­è¨€</p>
    </div>
    <div class="gantt-wrapper">
      <gantt :style-config="styleConfig" :data-config="dataConfig" :event-config="eventConfig">
      </gantt>
    </div>
  </div>

  <!-- å¼•å…¥ Gantt ç»„ä»¶ UMD åŒ… -->
  <script src="./dist/vue3-gantt.umd.js"></script>

  <script>
    const { createApp } = Vue;
    // ä» Vue3Gantt ä¸­è§£æ„æ‰€éœ€å†…å®¹
    const Gantt = Vue3Gantt.default || Vue3Gantt.Gantt;
    const LinkType = Vue3Gantt.LinkType || {
      FINISH_TO_START: 0,
      START_TO_START: 1,
      FINISH_TO_FINISH: 2,
      START_TO_FINISH: 3
    };

    const app = createApp({
      components: {
        Gantt
      },
      data() {
        const today = dayjs();
        const currentMonth = today.format('YYYY-MM');
        const startOfMonth = today.startOf('month').format('YYYY-MM-DD');
        const endOfMonth = today.endOf('month').format('YYYY-MM-DD');
              
        return {
          styleConfig: {
            headersHeight: 100,
            rowHeight: 60,
            setBarColor: (row) => {
              const colorMap = {
                'ç´§æ€¥': '#e74c3c',
                'é‡è¦': '#3498db',
                'ä¸€èˆ¬': '#95a5a6',
                'ä¸é‡è¦': '#f39c12'
              };
              return colorMap[row.level] || '#333333';
            }
          },
          dataConfig: {
            queryStartDate: startOfMonth,
            queryEndDate: endOfMonth,
            dataSource: [
              {
                id: '1',
                pid: '0',
                taskNo: 'é¡¹ç›®è§„åˆ’é˜¶æ®µ',
                level: 'é‡è¦',
                start_date: `${currentMonth}-01 08:00:00`,
                end_date: `${currentMonth}-06 18:00:00`,
                job_progress: '0.85',
                spend_time: null
              },
              {
                id: '2',
                pid: '1',
                taskNo: 'éœ€æ±‚åˆ†æ',
                level: 'ç´§æ€¥',
                start_date: `${currentMonth}-01 08:00:00`,
                end_date: `${currentMonth}-02 18:00:00`,
                job_progress: '1.0',
                spend_time: null
              },
              {
                id: '3',
                pid: '1',
                taskNo: 'æŠ€æœ¯é€‰å‹',
                level: 'é‡è¦',
                start_date: `${currentMonth}-03 08:00:00`,
                end_date: `${currentMonth}-04 18:00:00`,
                job_progress: '0.9',
                spend_time: null
              },
              {
                id: '4',
                pid: '1',
                taskNo: 'æ¶æ„è®¾è®¡',
                level: 'é‡è¦',
                start_date: `${currentMonth}-05 08:00:00`,
                end_date: `${currentMonth}-06 18:00:00`,
                job_progress: '0.7',
                spend_time: null
              },
              {
                id: '5',
                pid: '0',
                taskNo: 'å¼€å‘é˜¶æ®µ',
                level: 'é‡è¦',
                start_date: `${currentMonth}-07 08:00:00`,
                end_date: `${currentMonth}-18 18:00:00`,
                job_progress: '0.5',
                spend_time: null
              },
              {
                id: '6',
                pid: '5',
                taskNo: 'å‰ç«¯å¼€å‘',
                level: 'é‡è¦',
                start_date: `${currentMonth}-07 08:00:00`,
                end_date: `${currentMonth}-13 18:00:00`,
                job_progress: '0.6',
                spend_time: null
              },
              {
                id: '7',
                pid: '5',
                taskNo: 'åç«¯å¼€å‘',
                level: 'é‡è¦',
                start_date: `${currentMonth}-10 08:00:00`,
                end_date: `${currentMonth}-18 18:00:00`,
                job_progress: '0.5',
                spend_time: null
              }
            ],
            dependencies: [
              { sourceTaskId: '2', targetTaskId: '3', type: 0 }, // FINISH_TO_START
              { sourceTaskId: '3', targetTaskId: '4', type: 0 }, // FINISH_TO_START
              { sourceTaskId: '1', targetTaskId: '5', type: 0 }, // FINISH_TO_START
              { sourceTaskId: '6', targetTaskId: '7', type: 1 }  // START_TO_START
            ],
            mapFields: {
              id: 'id',
              parentId: 'pid',
              task: 'taskNo',
              priority: 'level',
              startdate: 'start_date',
              enddate: 'end_date',
              takestime: 'spend_time',
              progress: 'job_progress'
            },
            taskHeaders: [
              { title: 'åºå·', width: 160, property: 'no', show: true },
              { title: 'ä»»åŠ¡åç§°', width: 190, property: 'task', show: true },
              { title: 'ä¼˜å…ˆçº§', width: 90, property: 'priority', show: true },
              { title: 'å¼€å§‹æ—¶é—´', width: 150, property: 'startdate', show: true },
              { title: 'ç»“æŸæ—¶é—´', width: 150, property: 'enddate', show: true },
              { title: 'è€—æ—¶', width: 90, property: 'takestime', show: true }
            ]
          },
          eventConfig: {
            addRootTask: (row) => {
              // æ·»åŠ æ ¹ä»»åŠ¡äº‹ä»¶
            },
            addSubTask: (task) => {
              // æ·»åŠ å­ä»»åŠ¡äº‹ä»¶
            },
            removeTask: (task) => {
              // åˆ é™¤ä»»åŠ¡äº‹ä»¶
            },
            editTask: (task) => {
              // ç¼–è¾‘ä»»åŠ¡äº‹ä»¶
            },
            queryTask: (startDate, endDate, mode) => {
              // æŸ¥è¯¢ä»»åŠ¡äº‹ä»¶
            },
            barDate: (id, startDate, endDate) => {
              // ä»»åŠ¡æ—¥æœŸå˜æ›´äº‹ä»¶
            },
            allowChangeTaskDate: (allow) => {
              // æ˜¯å¦å…è®¸æ”¹å˜ä»»åŠ¡æ—¥æœŸ
            },
            updateProgress: (detail) => {
              // è¿›åº¦æ›´æ–°äº‹ä»¶
            }
          }
        };
      },
      mounted() {
        // é‡è¦ï¼šéœ€è¦ç­‰å¾…ä¸€ä¸ª tick è®©ç»„ä»¶å®Œå…¨åˆå§‹åŒ–
        setTimeout(() => {
          const startDate = this.dataConfig.queryStartDate;
          const endDate = this.dataConfig.queryEndDate;

          if (this.eventConfig.queryTask) {
            this.eventConfig.queryTask(startDate, endDate, 'æœˆ');
          }
        }, 100);
      }
    });

    app.mount('#app');
  </script>
</body>

</html>