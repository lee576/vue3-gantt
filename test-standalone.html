<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vue3 Gantt - æœ¬åœ°æµ‹è¯•</title>
  
  <!-- å¼•å…¥æœ¬åœ° Vue 3 -->
  <script src="https://unpkg.com/vue@3.5.13/dist/vue.global.prod.js"></script>
  <!-- å¼•å…¥æœ¬åœ°ä¾èµ–åº“ -->
  <script src="https://unpkg.com/dayjs@1.11.13/dayjs.min.js"></script>
  <script src="https://unpkg.com/@vueuse/core@11.3.0/index.iife.min.js"></script>
  <script src="https://unpkg.com/interactjs@1.10.27/dist/interact.min.js"></script>
  <script src="https://unpkg.com/svg.js@2.7.1/dist/svg.min.js"></script>
  
  <!-- å¼•å…¥ Gantt ç»„ä»¶æ ·å¼ -->
  <link rel="stylesheet" href="./dist/vue3-gantt.css">
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      overflow: hidden;
    }
    
    #app {
      width: 100vw;
      height: 100vh;
    }
  </style>
</head>
<body>
  <div id="app">
    <gantt 
      :style-config="styleConfig" 
      :data-config="dataConfig" 
      :event-config="eventConfig">
    </gantt>
  </div>

  <!-- å¼•å…¥ Gantt ç»„ä»¶ UMD åŒ… -->
  <script src="./dist/vue3-gantt.umd.js"></script>

  <script>
    const { createApp } = Vue;
    const Gantt = Vue3Gantt.default || Vue3Gantt.Gantt || Vue3Gantt;

    const app = createApp({
      components: {
        Gantt
      },
      data() {
        const today = dayjs();
        const currentMonth = today.format('YYYY-MM');
        const startOfMonth = today.startOf('month').format('YYYY-MM-DD');
        const endOfMonth = today.endOf('month').format('YYYY-MM-DD');
        
        console.log('ğŸ“… åˆå§‹åŒ–æ—¶é—´èŒƒå›´:', startOfMonth, 'åˆ°', endOfMonth);
        
        return {
          styleConfig: {
            headersHeight: 100,
            rowHeight: 60,
            setBarColor: (row) => {
              const colorMap = {
                'ç´§æ€¥': '#e74c3c',
                'é‡è¦': '#3498db',
                'ä¸€èˆ¬': '#95a5a6'
              };
              return colorMap[row.level] || '#333333';
            }
          },
          dataConfig: {
            queryStartDate: startOfMonth,
            queryEndDate: endOfMonth,
            dataSource: [
              {
                id: '1',
                pid: '0',
                taskNo: 'é¡¹ç›®è§„åˆ’',
                level: 'é‡è¦',
                start_date: `${currentMonth}-01 08:00:00`,
                end_date: `${currentMonth}-05 18:00:00`,
                job_progress: '0.8',
                spend_time: null
              },
              {
                id: '2',
                pid: '1',
                taskNo: 'éœ€æ±‚åˆ†æ',
                level: 'ç´§æ€¥',
                start_date: `${currentMonth}-01 08:00:00`,
                end_date: `${currentMonth}-02 18:00:00`,
                job_progress: '1.0',
                spend_time: null
              },
              {
                id: '3',
                pid: '1',
                taskNo: 'æŠ€æœ¯é€‰å‹',
                level: 'é‡è¦',
                start_date: `${currentMonth}-03 08:00:00`,
                end_date: `${currentMonth}-05 18:00:00`,
                job_progress: '0.6',
                spend_time: null
              },
              {
                id: '4',
                pid: '0',
                taskNo: 'å¼€å‘é˜¶æ®µ',
                level: 'é‡è¦',
                start_date: `${currentMonth}-06 08:00:00`,
                end_date: `${currentMonth}-15 18:00:00`,
                job_progress: '0.5',
                spend_time: null
              },
              {
                id: '5',
                pid: '4',
                taskNo: 'å‰ç«¯å¼€å‘',
                level: 'é‡è¦',
                start_date: `${currentMonth}-06 08:00:00`,
                end_date: `${currentMonth}-12 18:00:00`,
                job_progress: '0.6',
                spend_time: null
              },
              {
                id: '6',
                pid: '4',
                taskNo: 'åç«¯å¼€å‘',
                level: 'ä¸€èˆ¬',
                start_date: `${currentMonth}-08 08:00:00`,
                end_date: `${currentMonth}-15 18:00:00`,
                job_progress: '0.4',
                spend_time: null
              }
            ],
            dependencies: [
              { sourceTaskId: '2', targetTaskId: '3', type: 0 },  // FS
              { sourceTaskId: '1', targetTaskId: '4', type: 0 },  // FS
              { sourceTaskId: '5', targetTaskId: '6', type: 1 }   // SS
            ],
            mapFields: {
              id: 'id',
              parentId: 'pid',
              task: 'taskNo',
              priority: 'level',
              startdate: 'start_date',
              enddate: 'end_date',
              takestime: 'spend_time',
              progress: 'job_progress'
            },
            taskHeaders: [
              { title: 'åºå·', width: 160, property: 'no', show: true },
              { title: 'ä»»åŠ¡åç§°', width: 200, property: 'task', show: true },
              { title: 'ä¼˜å…ˆçº§', width: 90, property: 'priority', show: true },
              { title: 'å¼€å§‹æ—¶é—´', width: 150, property: 'startdate', show: true },
              { title: 'ç»“æŸæ—¶é—´', width: 150, property: 'enddate', show: true }
            ]
          },
          eventConfig: {
            addRootTask: (row) => console.log('æ·»åŠ æ ¹ä»»åŠ¡', row),
            addSubTask: (task) => console.log('æ·»åŠ å­ä»»åŠ¡', task),
            removeTask: (task) => console.log('åˆ é™¤ä»»åŠ¡', task),
            editTask: (task) => console.log('ç¼–è¾‘ä»»åŠ¡', task),
            queryTask: (startDate, endDate, mode) => {
              console.log('æŸ¥è¯¢ä»»åŠ¡', { startDate, endDate, mode });
              // æ³¨æ„ï¼šè¿™é‡Œä¸éœ€è¦é‡æ–°è®¾ç½® dataSourceï¼Œå› ä¸ºå·²ç»åœ¨ data ä¸­åˆå§‹åŒ–äº†
              // å¦‚æœéœ€è¦ä»åç«¯è·å–æ•°æ®ï¼Œåœ¨è¿™é‡Œè°ƒç”¨ API
            },
            barDate: (id, startDate, endDate) => {
              console.log('æ—¥æœŸå˜æ›´', { id, startDate, endDate });
            },
            allowChangeTaskDate: (allow) => {
              console.log('å…è®¸æ”¹å˜æ—¥æœŸ', allow);
            },
            updateProgress: (detail) => {
              console.log('è¿›åº¦æ›´æ–°', detail);
            }
          }
        };
      },
      mounted() {
        console.log('âœ… Vue3 Gantt ç»„ä»¶åŠ è½½æˆåŠŸï¼');
        console.log('ğŸ“¦ å¯ç”¨å¯¼å‡º:', Object.keys(Vue3Gantt));
        console.log('ğŸ“¦ æ•°æ®æº:', this.dataConfig.dataSource.length, 'æ¡ä»»åŠ¡');
        
        // é‡è¦ï¼šéœ€è¦ç­‰å¾…ä¸€ä¸ª tick è®©ç»„ä»¶å®Œå…¨åˆå§‹åŒ–
        setTimeout(() => {
          const startDate = this.dataConfig.queryStartDate;
          const endDate = this.dataConfig.queryEndDate;
          
          console.log('ğŸ”„ è§¦å‘ queryTask:', startDate, 'åˆ°', endDate);
          
          if (this.eventConfig.queryTask) {
            this.eventConfig.queryTask(startDate, endDate, 'æœˆ');
          }
        }, 100);
      }
    });

    app.mount('#app');
  </script>
</body>
</html>
